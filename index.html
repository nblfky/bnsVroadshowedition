<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>bnsVision</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
  <meta name="theme-color" content="#00b14f">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="bnsVision">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <img src="grab_logo.png" alt="Grab logo">
    <div class="header-title">
      <span class="app-name">bnsVision</span>
      <div class="roadshow-edition">ROADSHOW EDITION</div>
    </div>
  </header>
  <main>
    <div class="video-wrapper">
      <video id="camera" autoplay playsinline></video>
      <div id="progressBar"><div id="progressFill"></div></div>
      <button id="scanBtn" class="scan-btn">Scan</button>
      
      <!-- Zoom Controls -->
      <div class="zoom-controls">
        <button id="zoomOut" class="zoom-btn" title="Zoom Out">‚àí</button>
        <div class="zoom-indicator">
          <span id="zoomLevel">1.0x</span>
        </div>
        <button id="zoomIn" class="zoom-btn" title="Zoom In">+</button>
        <button id="zoomReset" class="zoom-reset-btn" title="Reset Zoom">‚åÇ</button>
      </div>
      
      <div id="scanningOverlay" class="scanning-overlay">
        <div class="scanning-content">
          <div class="spinner"></div>
          <div class="scanning-text">Scanning...</div>
        </div>
      </div>
    </div>

    <!-- Collapsible Map Section -->
    <div id="mapContainer" class="map-container">
      <div class="map-header">
        <div class="map-info">
          <span id="mapStatus">üìç Loading location...</span>
          <span id="routeProgress"></span>
        </div>
        <div class="map-header-buttons">
          <button id="followLocationBtn" class="map-follow-btn" title="Follow Location">üéØ</button>
          <button id="requestLocationBtn" class="map-location-btn" title="Request Location" style="display:none;">üìç</button>
          <button id="mapExpandBtn" class="map-expand-btn" title="Expand Map">‚õ∂</button>
        </div>
      </div>
      <div id="miniMap" class="mini-map"></div>
      
      <!-- Full Screen Map Overlay -->
      <div id="fullMapOverlay" class="full-map-overlay hidden">
        <div class="full-map-header">
          <h3>Route Planning</h3>
          <div class="map-controls">
            <button id="centerOnUserBtn" class="map-btn">üìç My Location</button>
            <button id="clearRouteBtn" class="map-btn">Clear Route</button>
            <button id="addRoutePointModeBtn" class="map-btn">Add Point</button>
            <button id="markerStyleBtn" class="map-btn" title="Cycle marker style">Marker: Cross</button>
            <button id="optimizeRouteBtn" class="map-btn">Optimize</button>
          </div>
          <button id="mapCloseBtn" class="map-close-btn">√ó</button>
        </div>
        <div id="fullMap" class="full-map"></div>
        <div class="map-footer">
          <div class="route-stats">
            <span id="routeDistance">Distance: 0 km</span>
            <span id="routeTime">Time: 0 min</span>
            <span id="routePoints">Points: 0</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Treasure Hunt Section (Event-only placeholders) -->
    <div class="card treasure-card">
      <div class="treasure-header treasure-header-stacked">
        <h3 class="treasure-title">Navigation Hunt</h3>
        <div class="treasure-header-actions">
          <button id="introBtn" class="btn btn-light">Introduction</button>
          <button id="guideBtn" class="btn btn-light">Guide</button>
          <button id="navMapBtn" class="btn btn-light">Map</button>
          <button id="secretBtn" class="btn btn-light" disabled>Secret</button>
        </div>
      </div>
      <p class="treasure-subtitle">Find all the hidden stores, good luck!</p>
      <div id="treasureGrid" class="treasure-grid">
        <div class="hunt-item" data-index="0">
          <div class="hunt-image"><span>No image yet</span></div>
          <div class="hunt-actions">
            <button class="btn hunt-use-latest">Use Latest Scan</button>
            <button class="btn hunt-pick">Pick From Scans</button>
            <button class="btn hunt-clear">Clear</button>
          </div>
          <p class="hunt-riddle"><em></em></p>
        </div>
        <div class="hunt-item" data-index="1">
          <div class="hunt-image"><span>No image yet</span></div>
          <div class="hunt-actions">
            <button class="btn hunt-use-latest">Use Latest Scan</button>
            <button class="btn hunt-pick">Pick From Scans</button>
            <button class="btn hunt-clear">Clear</button>
          </div>
          <p class="hunt-riddle"><em></em></p>
        </div>
        <div class="hunt-item" data-index="2">
          <div class="hunt-image"><span>No image yet</span></div>
          <div class="hunt-actions">
            <button class="btn hunt-use-latest">Use Latest Scan</button>
            <button class="btn hunt-pick">Pick From Scans</button>
            <button class="btn hunt-clear">Clear</button>
          </div>
          <p class="hunt-riddle"><em></em></p>
        </div>
      </div>
    </div>

    <!-- Introduction Modal -->
    <div id="introModal" class="treasure-picker-modal hidden">
      <div class="treasure-picker-content">
        <div class="treasure-picker-header">
          <h3>Introduction</h3>
          <button id="introClose" class="map-close-btn" title="Close">√ó</button>
        </div>
        <div class="guide-body">
          <p>bnsVision is a web-based scanner app designed for onground collection purposes, specifically storefronts. Navigate your way through the five places around the event with bnsVision, explore and discover them by capturing their storefronts. End your journey after discovering all the places and win a prize, or challenge yourself to find the secret item. </p>
        </div>
      </div>
    </div>

    <!-- Guide Modal -->
    <div id="guideModal" class="treasure-picker-modal hidden">
      <div class="treasure-picker-content">
        <div class="treasure-picker-header">
          <h3>Game Guide</h3>
          <button id="guideClose" class="map-close-btn" title="Close">√ó</button>
        </div>
        <div class="guide-body">
          <p>Complete the Navigation Hunt by finding every store poster and verifying it with a scan.</p>
          <ul>
            <li>Tap <strong>Scan</strong> to capture a poster at the location.</li>
            <li>Use <strong>Use Latest Scan</strong> or <strong>Pick From Scans</strong> to attach your photo.</li>
            <li>Matched locations unlock the next clue.</li>
            <li>Open the <strong>Navigation Map</strong> for directions and tips.</li>
            <li>Finish all clues to get a sticker and unlock the <strong>Secret</strong> riddle.</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Treasure Picker Modal -->
    <div id="treasurePickerModal" class="treasure-picker-modal hidden">
      <div class="treasure-picker-content">
        <div class="treasure-picker-header">
          <h3>Select a scan</h3>
          <button id="treasurePickerClose" class="map-close-btn" title="Close">√ó</button>
        </div>
        <div class="treasure-picker-grid" id="treasurePickerGrid"></div>
      </div>
    </div>

    <!-- Navigation Map Modal -->
    <div id="navMapModal" class="treasure-picker-modal hidden">
      <div class="treasure-picker-content">
        <div class="treasure-picker-header">
          <h3>Navigation Map</h3>
          <button id="navMapClose" class="map-close-btn" title="Close">√ó</button>
        </div>
        <div class="nav-map-body">
          <div id="navMapPlaceholder" class="nav-map-placeholder"><img id="navMapImage" src="nav-map.png" alt="Navigation Map"></div>
        </div>
      </div>
    </div>

    <!-- Secret Modal -->
    <div id="secretModal" class="treasure-picker-modal hidden">
      <div class="treasure-picker-content">
        <div class="treasure-picker-header">
          <h3>Secret Riddle</h3>
          <button id="secretClose" class="map-close-btn" title="Close">√ó</button>
        </div>
        <div class="secret-body">
          <p><em>‚ÄúI‚Äôm swift, I‚Äôm mobile, I‚Äôm always on the move. Find me where composition, depth and resolution improve. Ever-changing perspective, creating new narrative. I am where green shines bright, but hurry... my path isn‚Äôt fixed in the light.‚Äù</em></p>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="toolbar">
        <button id="exportBtn" class="btn">Export CSV</button>
        <button id="downloadAllPhotosBtn" class="btn">üì∏ Download All Photos</button>
        <button id="uploadBtn" class="btn">Upload Image</button>
        <button id="clearBtn" class="btn">Clear</button>
        <input type="file" id="imageInput" accept="image/*" style="display:none" />
      </div>
      <div class="search-toolbar">
        <input type="text" id="storeSearchInput" placeholder="Search for store name in table..." />
        <button id="searchLocationBtn" class="btn">üîç Search</button>
        <button id="photoCaptureToggle" class="btn photo-toggle" title="Toggle photo capture">üì∏ Photo: ON</button>
      </div>
      <div id="status" class="muted"></div>
      <div class="table-container">
        <table id="resultsTable">
          <thead>
            <tr>
              <th>#</th>
              <th>Photo</th>
              <th>POI Name</th>
              <th>Lat-Long</th>
              <th>House_No</th>
              <th>Street</th>
              <th>Unit</th>
              <th>Building</th>
              <th>Postcode</th>
              <th>Remarks</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </main>

  <!-- Leaflet.js for Maps -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <!-- Leaflet.Draw for map annotations -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css" />
  <script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>
  
  <!-- OCR Library -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
  <!-- Spell correction library -->
  <script src="https://cdn.jsdelivr.net/npm/didyoumean2@3/dist/didyoumean2.min.js"></script>
  <!-- App logic (ESM) -->
  <script type="module" src="script.js"></script>
</body>
</html> 